(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3aa2d7ae"],{1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},2:function(e,t){},"2ade":function(e,t,s){"use strict";var i=s("cebe"),a=s.n(i),r=s("5c96"),o=s("f3e4"),n=s("14b7"),l=s.n(n);const h=a.a.create({baseURL:"http://localhost:9000",timeout:12e3});h.interceptors.request.use(e=>(Object(o["a"])()&&(e.headers["Authorization"]="Bearer "+Object(o["a"])()),e.headers["Content-Type"]="application/json;charset=utf-8",e),e=>{console.log(e),Promise.reject(e)}),h.interceptors.response.use(e=>{console.log("response = ",e);let{data:t,msg:s,status:i}=e||{};"object"===typeof t&&t.hasOwnProperty("jwtToken")&&(Object(o["c"])(t.jwtToken),t=l.a.decode(t.jwtToken));let a={data:t,code:i};return i>=200&&i<300||0==i?(console.log("newData:",a),a):(Object(r["Message"])({type:"error",message:s}),Promise.reject(t))},e=>{const t=e.response,s=t.data.status;return s||Object(r["Message"])({type:"error",message:"接口请求失败"}),Promise.reject(e)}),t["a"]=h},3:function(e,t){},"37ac":function(e,t,s){"use strict";s("e19b")},"3f19":function(e,t,s){e.exports=s.p+"static/img/delicon.2b014ff4.jpg"},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},"915e":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"AILabel"},[t("ul",{staticClass:"toolbar"},[t("li",{on:{click:function(t){return e.setMode("PAN")}}},[t("el-tooltip",{attrs:{content:"平移",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"50","p-id":"2275",t:"1657849698286",version:"1.1",viewBox:"0 0 1024 1024",width:"50",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M486.4 776.533333v-213.333333H247.466667v106.666667L85.333333 512l162.133334-162.133333V512h238.933333V247.466667H349.866667L512 85.333333l162.133333 162.133334h-132.266666V512h238.933333V349.866667L938.666667 512l-162.133334 162.133333v-106.666666h-238.933333v213.333333h132.266667L512 938.666667l-162.133333-162.133334h136.533333z",fill:"#e6e6e6","p-id":"2276"}})])])],1),t("li",{on:{click:function(t){return e.setMode("ZOOM+")}}},[t("el-tooltip",{attrs:{content:"放大",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"30","p-id":"7963",t:"1657850484953",version:"1.1",viewBox:"0 0 1024 1024",width:"30",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z",fill:"#e6e6e6","p-id":"7964"}}),t("path",{attrs:{d:"M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z",fill:"#e6e6e6","p-id":"7965"}})])])],1),t("li",{on:{click:function(t){return e.setMode("ZOOM-")}}},[t("el-tooltip",{attrs:{content:"缩小",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"30","p-id":"8949",t:"1657850524018",version:"1.1",viewBox:"0 0 1024 1024",width:"30",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z",fill:"#e6e6e6","p-id":"8950"}}),t("path",{attrs:{d:"M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z",fill:"#e6e6e6","p-id":"8951"}})])])],1)]),t("div",{ref:"map",attrs:{id:"map"}}),t("div",{staticClass:"btnlist"},[t("el-button",{attrs:{type:"success"},on:{click:e.closewindows}},[e._v("返回")])],1)])},a=[],r=(s("14d9"),s("7e66")),o=s.n(r),n=s("c24f"),l=s("a1e9"),h=s("3f19"),d=s.n(h),g={name:"AILabel",data(){return{data:this.$route.query,listQuery:{imageID:this.$route.query.imageID,userID:this.$route.query.userID,path:this.$route.query.path,annotationResult:""},gMap:null,gFirstImageLayer:null,gFirstFeatureLayer:null,gFirstTextLayer:null,drawingStyle:{},allFeatures:[],imgList:[{id:1,src:"http://localhost:9000"+this.$route.query.path,width:1920,height:1080,zoom:5e3}],drawerFlag:!1,formLabelAlign:{input:"text",borderwidth:1,bordercolor:"#00f",fontColor:"#0f0",fontbgColor:"#F4A460",fontborderColor:"#D2691E"},rules:{input:[{required:!0,message:"请输入需要标注的文字！",trigger:"blur"}]},oldfeature:null,imglistInedx:0}},methods:{toggleDrawer(){console.log(123),this.drawerFlag=!0,this.gMap.setMode("PAN")},closewindows(){window.opener=null,window.open("about:blank","_top").close()},pre(){0!=this.imglistInedx&&(this.imglistInedx-=1,this.switchImage(this.imgList[this.imglistInedx]),this.EchoData())},next(){this.imglistInedx!=this.imgList.length-1&&(this.imglistInedx+=1,this.switchImage(this.imgList[this.imglistInedx]),this.EchoData())},initMap(){this.gMap=new o.a.Map("map",{center:{x:960,y:540},zoom:800,mode:"PAN",refreshDelayWhenZooming:!0,zoomWhenDrawing:!0,panWhenDrawing:!1}),this.eventMaps(),this.switchImage(this.imgList[0]),this.gFirstFeatureLayer=new o.a.Layer.Feature("first-layer-feature",{name:"第一个矢量图层"},{zIndex:10}),this.gFirstTextLayer=new o.a.Layer.Text("first-layer-text",{name:"第一个文本图层"},{zIndex:12,opacity:1}),this.gMap.addLayer(this.gFirstTextLayer),this.gMap.addLayer(this.gFirstFeatureLayer),this.EchoData()},EchoData(){Object(n["b"])(this.listQuery).then(e=>{const t=e.data;this.listQuery.annotationResult=t[t.length-1].annotationResult;let{newallFeatures:s,newalllText:i}=JSON.parse(this.listQuery.annotationResult)[this.imgList[this.imglistInedx].id]?JSON.parse(this.listQuery.annotationResult)[this.imgList[this.imglistInedx].id]:{newallFeatures:[],newalllText:[]};i.forEach(({id:e,props:t,textInfo:s,style:i})=>{const a=new o.a.Text(e,{...s},{...t},{...i});this.gFirstTextLayer.addText(a)}),s.forEach(({id:e,props:t,shape:s,style:i,type:a})=>{if("RECT"===a){const a=new o.a.Feature.Rect(e,s,t,i);this.gFirstFeatureLayer.addFeature(a)}else if("POLYGON"===a){const a=new o.a.Feature.Polygon(e,s,t,i);this.gFirstFeatureLayer.addFeature(a)}})})},getCenter(e=[]){let t={x:0,y:0},s=e.length;if(s){let i=0,a=0;e.forEach(e=>{i+=e.x,a+=e.y}),t.x=i/s,t.y=a/s}return t},isPOLYGON(e=[],t,s){let i=!0;return e.forEach(e=>{i&&(e.x<0||e.x>t||e.y<0||e.y>s)&&(i=!1)}),i},eventMaps(){let e=this.gMap;e.events.on("drawDone",(e,t)=>{let{width:s,height:i}=this.gFirstImageLayer.imageInfo;const a="label-text-id-"+ +new Date,r="label-marker-id-"+ +new Date;if("RECT"===e){if(t.x<0||t.y<0||t.width+t.x>=s||t.height+t.y>=i)return void this.$message.error("超出边界!");const e=new o.a.Feature.Rect(""+ +new Date,t,{name:"RECT",textId:a,deleteMarkerId:r},this.drawingStyle);this.gFirstFeatureLayer.addFeature(e);const{x:n,y:l}=t,h=new o.a.Text(a,{text:this.formLabelAlign.input,position:{x:n,y:l},offset:{x:0,y:0}},{name:"text",textId:a,deleteMarkerId:r},{fillStyle:this.formLabelAlign.fontbgColor,strokeStyle:this.formLabelAlign.fontborderColor,background:!0,globalAlpha:1,fontColor:this.formLabelAlign.fontColor});this.gFirstTextLayer.addText(h)}else if("POLYGON"===e){if(!this.isPOLYGON(t,s,i))return void this.$message.error("超出边界!");const e=new o.a.Feature.Polygon(""+ +new Date,{points:t},{name:"POLYGON",textId:a,deleteMarkerId:r},this.drawingStyle);this.gFirstFeatureLayer.addFeature(e);const{x:n,y:l}=this.getCenter(t),h=new o.a.Text(a,{text:this.formLabelAlign.input,position:{x:n,y:l},offset:{x:-10,y:-10}},{name:"text"},{fillStyle:this.formLabelAlign.fontbgColor,strokeStyle:this.formLabelAlign.fontborderColor,background:!0,globalAlpha:1,fontColor:this.formLabelAlign.fontColor});this.gFirstTextLayer.addText(h)}}),e.events.on("featureSelected",t=>{this.oldfeature=t,e.setActiveFeature(t);const s=t.props.deleteMarkerId,i=t.props.textId,a=e.markerLayer.getMarkerById(s);if("RECT"===t.type){if(a)return;const r=new o.a.Marker(s,{src:"@/assets/images/delicon.jpg",position:t.getPoints()[1],offset:{x:-35,y:-5},width:30,height:30},{name:"delIcon"});r.events.on("click",s=>{e.markerLayer.removeMarkerById(s.id),this.gFirstTextLayer.removeTextById(i),this.gFirstFeatureLayer.removeFeatureById(t.id)}),e.markerLayer.addMarker(r)}else{const s=t.props.deleteMarkerId,a=new o.a.Marker(s,{src:d.a,position:this.getCenter(t.shape.points),offset:{x:0,y:-20},width:30,height:30},{name:"delIcon"});a.events.on("click",s=>{e.markerLayer.removeMarkerById(s.id),this.gFirstTextLayer.removeTextById(i),this.gFirstFeatureLayer.removeFeatureById(t.id)}),e.markerLayer.addMarker(a)}}),e.events.on("featureUnselected",t=>{e.setActiveFeature(null),e.markerLayer.removeMarkerById(t.props.deleteMarkerId)}),e.events.on("featureUpdated",(e,t)=>{if("RECT"===e.type){let{width:s,height:i}=this.gFirstImageLayer.imageInfo,a=t;if(a.x<0||a.y<0||a.width+a.x>=s||a.height+a.y>=i)return e.updateShape(this.oldfeature.shape),void this.$message.error("超出边界!");e.updateShape(t);const r=e.props.deleteMarkerId,o=e.props.textId,n=this.gMap.markerLayer.getMarkerById(r);n.updatePosition(e.getPoints()[1]);const l=this.gFirstTextLayer.getTextById(o);console.log("--targetText--",l),l.updatePosition(e.getPoints()[0])}else if("POLYGON"===e.type){let{width:s,height:i}=this.gFirstImageLayer.imageInfo;if(!this.isPOLYGON(t.points,s,i))return e.updateShape(this.oldfeature.shape),void this.$message.error("超出边界!");e.updateShape(t);const a=e.props.deleteMarkerId,r=e.props.textId,o=this.gMap.markerLayer.getMarkerById(a);o.updatePosition(this.getCenter(t.points));const n=this.gFirstTextLayer.getTextById(r);n.updatePosition(this.getCenter(t.points))}})},switchImage(e){const t=e.src;this.gFirstImageLayer&&this.gMap.removeLayerById("first-layer-image"),this.gFirstTextLayer&&this.gFirstTextLayer.removeAllTexts(),this.gFirstFeatureLayer&&this.gFirstFeatureLayer.removeAllFeatures(),this.gMap.markerLayer.removeAllMarkers(),this.gFirstImageLayer=new o.a.Layer.Image("first-layer-image",{src:t,width:e.width,height:e.height,position:{x:0,y:0}},{name:"layer-image"},{zIndex:5}),this.gMap.addLayer(this.gFirstImageLayer),this.gMap.centerAndZoom({center:{x:e.width/2,y:e.height/2},zoom:e.zoom})},setMode(e){switch(e){case"PAN":this.gMap.setMode(e);break;case"RECT":this.gMap.setMode(e),this.drawingStyle={strokeStyle:this.formLabelAlign.bordercolor,lineWidth:this.formLabelAlign.borderwidth},this.gMap.setDrawingStyle(this.drawingStyle);break;case"POLYGON":this.gMap.setMode(e),this.drawingStyle={strokeStyle:this.formLabelAlign.bordercolor,lineWidth:this.formLabelAlign.borderwidth},this.gMap.setDrawingStyle(this.drawingStyle);break;case"ZOOM+":this.gMap.zoomIn();break;case"ZOOM-":this.gMap.zoomOut();break;default:break}},getFeatures(){this.allFeatures=this.gFirstFeatureLayer.getAllFeatures()},Revoke(){this.getFeatures(),this.allFeatures.length&&(this.gFirstTextLayer.removeTextById(this.allFeatures[this.allFeatures.length-1].props.textId),this.allFeatures.pop(),this.gMap.refresh())},async exportImgeBlob(){const e=await this.gMap.exportLayersToImage({x:0,y:0,width:1920,height:1080},{type:"blob",format:"image/png"}),t=document.createElement("a"),s=window.URL.createObjectURL(e),i="test";t.href=s,t.download=i,t.click(),window.URL.revokeObjectURL(s),this.$message.success("下载成功")},saveData(){const e=Object(l["a"])(this.gFirstFeatureLayer.getAllFeatures()),t=Object(l["a"])(this.gFirstTextLayer.getAllTexts());let s=[],i=[];t.forEach(({props:e,type:t,style:i,textInfo:a,id:r})=>{s.push(Object.assign({},{props:e,type:t,style:i,textInfo:a,id:r}))}),e.forEach(({props:e,type:t,style:s,shape:a,id:r})=>{i.push(Object.assign({},{props:e,type:t,style:s,shape:a,id:r}))}),this.listQuery.annotationResult=JSON.stringify({[this.imgList[this.imglistInedx].id]:{newalllText:s,newallFeatures:i}}),console.log("annotationResult:",this.listQuery.annotationResult),addAnnotation(this.listQuery).then(e=>{const t=e.data;console.log("上传标注返回数据：",t),e.code>=200&&e.code<300&&this.$message({type:"success",message:"上传成功!"})}).catch(()=>{this.$message({message:"上传失败！",type:"warning"})}),console.log(JSON.stringify({[this.imgList[this.imglistInedx].id]:{newalllText:s,newallFeatures:i}}))}},mounted(){this.initMap()},destroyed(){this.gMap.destroyed()}},c=g,u=(s("37ac"),s("2877")),p=Object(u["a"])(c,i,a,!1,null,null,null);t["default"]=p.exports},c24f:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return o}));var i=s("2ade");function a(e){return Object(i["a"])({url:"/api/image/delete/"+e,method:"delete",data:e})}function r(e){return Object(i["a"])({url:"/api/image/byByUploaderID/"+e.uploaderID,method:"get",params:e})}function o(e){return Object(i["a"])({url:"/api/annotation/byImageID/"+e.imageID,method:"get",params:e})}},e19b:function(e,t,s){}}]);