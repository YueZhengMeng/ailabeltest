(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-258da970"],{1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},2:function(e,t){},"2ade":function(e,t,a){"use strict";var i=a("cebe"),s=a.n(i),r=a("5c96"),n=a("f3e4"),o=a("14b7"),l=a.n(o);const h=s.a.create({baseURL:"http://localhost:9000",timeout:12e3});h.interceptors.request.use(e=>(Object(n["a"])()&&(e.headers["Authorization"]="Bearer "+Object(n["a"])()),e.headers["Content-Type"]="application/json;charset=utf-8",e),e=>{console.log(e),Promise.reject(e)}),h.interceptors.response.use(e=>{console.log("response = ",e);let{data:t,msg:a,status:i}=e||{};"object"===typeof t&&t.hasOwnProperty("jwtToken")&&(Object(n["c"])(t.jwtToken),t=l.a.decode(t.jwtToken));let s={data:t,code:i};return i>=200&&i<300||0==i?(console.log("newData:",s),s):(Object(r["Message"])({type:"error",message:a}),Promise.reject(t))},e=>{const t=e.response,a=t.data.status;return a||Object(r["Message"])({type:"error",message:"接口请求失败"}),Promise.reject(e)}),t["a"]=h},3:function(e,t){},"3f19":function(e,t,a){e.exports=a.p+"static/img/delicon.2b014ff4.jpg"},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},ba4d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"AILabel"},[t("ul",{staticClass:"toolbar"},[t("li",{on:{click:function(t){return e.setMode("PAN")}}},[t("el-tooltip",{attrs:{content:"平移",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"50","p-id":"2275",t:"1657849698286",version:"1.1",viewBox:"0 0 1024 1024",width:"50",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M486.4 776.533333v-213.333333H247.466667v106.666667L85.333333 512l162.133334-162.133333V512h238.933333V247.466667H349.866667L512 85.333333l162.133333 162.133334h-132.266666V512h238.933333V349.866667L938.666667 512l-162.133334 162.133333v-106.666666h-238.933333v213.333333h132.266667L512 938.666667l-162.133333-162.133334h136.533333z",fill:"#e6e6e6","p-id":"2276"}})])])],1),t("li",{on:{click:function(t){return e.setMode("ZOOM+")}}},[t("el-tooltip",{attrs:{content:"放大",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"30","p-id":"7963",t:"1657850484953",version:"1.1",viewBox:"0 0 1024 1024",width:"30",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z",fill:"#e6e6e6","p-id":"7964"}}),t("path",{attrs:{d:"M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z",fill:"#e6e6e6","p-id":"7965"}})])])],1),t("li",{on:{click:function(t){return e.setMode("ZOOM-")}}},[t("el-tooltip",{attrs:{content:"缩小",effect:"customized",placement:"right"}},[t("svg",{staticClass:"icon",attrs:{height:"30","p-id":"8949",t:"1657850524018",version:"1.1",viewBox:"0 0 1024 1024",width:"30",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z",fill:"#e6e6e6","p-id":"8950"}}),t("path",{attrs:{d:"M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z",fill:"#e6e6e6","p-id":"8951"}})])])],1)]),t("div",{ref:"map",attrs:{id:"map"}}),t("div",{staticClass:"btnlist"},[t("el-button",{attrs:{type:"success"},on:{click:e.checkpass}},[e._v("通过")]),t("el-button",{attrs:{type:"success"},on:{click:e.uncheckpass}},[e._v("不通过")])],1)])},s=[],r=(a("14d9"),a("7e66")),n=a.n(r),o=a("c24f"),l=a("f897"),h=a("a1e9"),c=a("3f19"),d=a.n(c),g={name:"AILabel",data(){return{data:this.$route.query,listQuery:{imageID:this.$route.query.imageID,annotationID:this.$route.query.annotationID,userID:this.$route.query.userID,path:this.$route.query.path,annotationResult:"",description:""},gMap:null,gFirstImageLayer:null,gFirstFeatureLayer:null,gFirstTextLayer:null,drawingStyle:{},allFeatures:[],imgList:[{id:1,src:"http://localhost:9000"+this.$route.query.path,width:1920,height:1080,zoom:5e3}],drawerFlag:!1,formLabelAlign:{input:"text",borderwidth:1,bordercolor:"#00f",fontColor:"#0f0",fontbgColor:"#F4A460",fontborderColor:"#D2691E"},rules:{input:[{required:!0,message:"请输入需要标注的文字！",trigger:"blur"}]},oldfeature:null,imglistInedx:0}},methods:{toggleDrawer(){console.log(123),this.drawerFlag=!0,this.gMap.setMode("PAN")},uncheckpass(){let e={annotationID:this.listQuery.annotationID,checkerID:this.listQuery.userID,checkOpinion:this.listQuery.checkOpinion,checkResult:2};Object(l["a"])(e).then(e=>{console.log("checkAnnotation",e),localStorage.setItem("_refreshChecker",Math.random()),window.opener=null,window.open("about:blank","_top").close()})},checkpass(){let e={annotationID:this.listQuery.annotationID,checkerID:this.listQuery.userID,checkOpinion:this.listQuery.checkOpinion,checkResult:1};Object(l["a"])(e).then(e=>{console.log("checkAnnotation",e),localStorage.setItem("_refreshChecker",Math.random()),window.opener=null,window.open("about:blank","_top").close()})},pre(){0!=this.imglistInedx&&(this.imglistInedx-=1,this.switchImage(this.imgList[this.imglistInedx]),this.EchoData())},next(){this.imglistInedx!=this.imgList.length-1&&(this.imglistInedx+=1,this.switchImage(this.imgList[this.imglistInedx]),this.EchoData())},initMap(){this.gMap=new n.a.Map("map",{center:{x:960,y:540},zoom:800,mode:"PAN",refreshDelayWhenZooming:!0,zoomWhenDrawing:!0,panWhenDrawing:!1}),this.eventMaps(),this.switchImage(this.imgList[0]),this.gFirstFeatureLayer=new n.a.Layer.Feature("first-layer-feature",{name:"第一个矢量图层"},{zIndex:10}),this.gFirstTextLayer=new n.a.Layer.Text("first-layer-text",{name:"第一个文本图层"},{zIndex:12,opacity:1}),this.gMap.addLayer(this.gFirstTextLayer),this.gMap.addLayer(this.gFirstFeatureLayer),this.EchoData()},EchoData(){Object(o["b"])(this.listQuery).then(e=>{const t=e.data;this.listQuery.annotationResult=t[t.length-1].annotationResult;let{newallFeatures:a,newalllText:i}=JSON.parse(this.listQuery.annotationResult)[this.imgList[this.imglistInedx].id]?JSON.parse(this.listQuery.annotationResult)[this.imgList[this.imglistInedx].id]:{newallFeatures:[],newalllText:[]};i.forEach(({id:e,props:t,textInfo:a,style:i})=>{const s=new n.a.Text(e,{...a},{...t},{...i});this.gFirstTextLayer.addText(s)}),a.forEach(({id:e,props:t,shape:a,style:i,type:s})=>{if("RECT"===s){const s=new n.a.Feature.Rect(e,a,t,i);this.gFirstFeatureLayer.addFeature(s)}else if("POLYGON"===s){const s=new n.a.Feature.Polygon(e,a,t,i);this.gFirstFeatureLayer.addFeature(s)}})})},getCenter(e=[]){let t={x:0,y:0},a=e.length;if(a){let i=0,s=0;e.forEach(e=>{i+=e.x,s+=e.y}),t.x=i/a,t.y=s/a}return t},isPOLYGON(e=[],t,a){let i=!0;return e.forEach(e=>{i&&(e.x<0||e.x>t||e.y<0||e.y>a)&&(i=!1)}),i},eventMaps(){let e=this.gMap;e.events.on("drawDone",(e,t)=>{let{width:a,height:i}=this.gFirstImageLayer.imageInfo;const s="label-text-id-"+ +new Date,r="label-marker-id-"+ +new Date;if("RECT"===e){if(t.x<0||t.y<0||t.width+t.x>=a||t.height+t.y>=i)return void this.$message.error("超出边界!");const e=new n.a.Feature.Rect(""+ +new Date,t,{name:"RECT",textId:s,deleteMarkerId:r},this.drawingStyle);this.gFirstFeatureLayer.addFeature(e);const{x:o,y:l}=t,h=new n.a.Text(s,{text:this.formLabelAlign.input,position:{x:o,y:l},offset:{x:0,y:0}},{name:"text",textId:s,deleteMarkerId:r},{fillStyle:this.formLabelAlign.fontbgColor,strokeStyle:this.formLabelAlign.fontborderColor,background:!0,globalAlpha:1,fontColor:this.formLabelAlign.fontColor});this.gFirstTextLayer.addText(h)}else if("POLYGON"===e){if(!this.isPOLYGON(t,a,i))return void this.$message.error("超出边界!");const e=new n.a.Feature.Polygon(""+ +new Date,{points:t},{name:"POLYGON",textId:s,deleteMarkerId:r},this.drawingStyle);this.gFirstFeatureLayer.addFeature(e);const{x:o,y:l}=this.getCenter(t),h=new n.a.Text(s,{text:this.formLabelAlign.input,position:{x:o,y:l},offset:{x:-10,y:-10}},{name:"text"},{fillStyle:this.formLabelAlign.fontbgColor,strokeStyle:this.formLabelAlign.fontborderColor,background:!0,globalAlpha:1,fontColor:this.formLabelAlign.fontColor});this.gFirstTextLayer.addText(h)}}),e.events.on("featureSelected",t=>{this.oldfeature=t,e.setActiveFeature(t);const a=t.props.deleteMarkerId,i=t.props.textId,s=e.markerLayer.getMarkerById(a);if("RECT"===t.type){if(s)return;const r=new n.a.Marker(a,{src:"@/assets/images/delicon.jpg",position:t.getPoints()[1],offset:{x:-35,y:-5},width:30,height:30},{name:"delIcon"});r.events.on("click",a=>{e.markerLayer.removeMarkerById(a.id),this.gFirstTextLayer.removeTextById(i),this.gFirstFeatureLayer.removeFeatureById(t.id)}),e.markerLayer.addMarker(r)}else{const a=t.props.deleteMarkerId,s=new n.a.Marker(a,{src:d.a,position:this.getCenter(t.shape.points),offset:{x:0,y:-20},width:30,height:30},{name:"delIcon"});s.events.on("click",a=>{e.markerLayer.removeMarkerById(a.id),this.gFirstTextLayer.removeTextById(i),this.gFirstFeatureLayer.removeFeatureById(t.id)}),e.markerLayer.addMarker(s)}}),e.events.on("featureUnselected",t=>{e.setActiveFeature(null),e.markerLayer.removeMarkerById(t.props.deleteMarkerId)}),e.events.on("featureUpdated",(e,t)=>{if("RECT"===e.type){let{width:a,height:i}=this.gFirstImageLayer.imageInfo,s=t;if(s.x<0||s.y<0||s.width+s.x>=a||s.height+s.y>=i)return e.updateShape(this.oldfeature.shape),void this.$message.error("超出边界!");e.updateShape(t);const r=e.props.deleteMarkerId,n=e.props.textId,o=this.gMap.markerLayer.getMarkerById(r);o.updatePosition(e.getPoints()[1]);const l=this.gFirstTextLayer.getTextById(n);console.log("--targetText--",l),l.updatePosition(e.getPoints()[0])}else if("POLYGON"===e.type){let{width:a,height:i}=this.gFirstImageLayer.imageInfo;if(!this.isPOLYGON(t.points,a,i))return e.updateShape(this.oldfeature.shape),void this.$message.error("超出边界!");e.updateShape(t);const s=e.props.deleteMarkerId,r=e.props.textId,n=this.gMap.markerLayer.getMarkerById(s);n.updatePosition(this.getCenter(t.points));const o=this.gFirstTextLayer.getTextById(r);o.updatePosition(this.getCenter(t.points))}})},switchImage(e){const t=e.src;this.gFirstImageLayer&&this.gMap.removeLayerById("first-layer-image"),this.gFirstTextLayer&&this.gFirstTextLayer.removeAllTexts(),this.gFirstFeatureLayer&&this.gFirstFeatureLayer.removeAllFeatures(),this.gMap.markerLayer.removeAllMarkers(),this.gFirstImageLayer=new n.a.Layer.Image("first-layer-image",{src:t,width:e.width,height:e.height,position:{x:0,y:0}},{name:"layer-image"},{zIndex:5}),this.gMap.addLayer(this.gFirstImageLayer),this.gMap.centerAndZoom({center:{x:e.width/2,y:e.height/2},zoom:e.zoom})},setMode(e){switch(e){case"PAN":this.gMap.setMode(e);break;case"RECT":this.gMap.setMode(e),this.drawingStyle={strokeStyle:this.formLabelAlign.bordercolor,lineWidth:this.formLabelAlign.borderwidth},this.gMap.setDrawingStyle(this.drawingStyle);break;case"POLYGON":this.gMap.setMode(e),this.drawingStyle={strokeStyle:this.formLabelAlign.bordercolor,lineWidth:this.formLabelAlign.borderwidth},this.gMap.setDrawingStyle(this.drawingStyle);break;case"ZOOM+":this.gMap.zoomIn();break;case"ZOOM-":this.gMap.zoomOut();break;default:break}},getFeatures(){this.allFeatures=this.gFirstFeatureLayer.getAllFeatures()},Revoke(){this.getFeatures(),this.allFeatures.length&&(this.gFirstTextLayer.removeTextById(this.allFeatures[this.allFeatures.length-1].props.textId),this.allFeatures.pop(),this.gMap.refresh())},async exportImgeBlob(){const e=await this.gMap.exportLayersToImage({x:0,y:0,width:1920,height:1080},{type:"blob",format:"image/png"}),t=document.createElement("a"),a=window.URL.createObjectURL(e),i="test";t.href=a,t.download=i,t.click(),window.URL.revokeObjectURL(a),this.$message.success("下载成功")},saveData(){const e=Object(h["a"])(this.gFirstFeatureLayer.getAllFeatures()),t=Object(h["a"])(this.gFirstTextLayer.getAllTexts());let a=[],i=[];t.forEach(({props:e,type:t,style:i,textInfo:s,id:r})=>{a.push(Object.assign({},{props:e,type:t,style:i,textInfo:s,id:r}))}),e.forEach(({props:e,type:t,style:a,shape:s,id:r})=>{i.push(Object.assign({},{props:e,type:t,style:a,shape:s,id:r}))}),this.listQuery.annotationResult=JSON.stringify({[this.imgList[this.imglistInedx].id]:{newalllText:a,newallFeatures:i}}),console.log("annotationResult:",this.listQuery.annotationResult),addAnnotation(this.listQuery).then(e=>{const t=e.data;console.log("上传标注返回数据：",t),e.code>=200&&e.code<300&&this.$message({type:"success",message:"上传成功!"})}).catch(()=>{this.$message({message:"上传失败！",type:"warning"})}),console.log(JSON.stringify({[this.imgList[this.imglistInedx].id]:{newalllText:a,newallFeatures:i}}))}},mounted(){this.initMap()},destroyed(){this.gMap.destroyed()}},u=g,p=(a("cda8"),a("2877")),y=Object(p["a"])(u,i,s,!1,null,null,null);t["default"]=y.exports},c24f:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return n}));var i=a("2ade");function s(e){return Object(i["a"])({url:"/api/image/delete/"+e,method:"delete",data:e})}function r(e){return Object(i["a"])({url:"/api/image/byByUploaderID/"+e.uploaderID,method:"get",params:e})}function n(e){return Object(i["a"])({url:"/api/annotation/byImageID/"+e.imageID,method:"get",params:e})}},cda8:function(e,t,a){"use strict";a("e5db")},e5db:function(e,t,a){},f897:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return n}));var i=a("2ade");function s(e){return Object(i["a"])({url:"/api/annotation/all",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/api/annotation/byCheckerID/"+e.checkerID,method:"get",params:e})}function n(e){return Object(i["a"])({url:"/api/annotation/check",method:"post",data:e})}}}]);